<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Black Nigth Guns</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    canvas {
      margin: 0;
      height: 420px;
      background-color: #3b3b3b;
      background-image:
        repeating-linear-gradient(
          90deg,
          #5a5a5a,
          #5a5a5a 48px,
          #333 48px,
          #333 50px
        ),
        repeating-linear-gradient(
          180deg,
          #5a5a5a,
          #5a5a5a 23px,
          #333 23px,
          #333 25px
        ),
        repeating-linear-gradient(
          180deg,
          transparent,
          transparent 25px,
          rgba(0, 0, 0, 0.1) 25px,
          rgba(0, 0, 0, 0.1) 50px
        );
      background-size: 
        100px 50px,   
        100px 50px,   
        100px 100px;  
      background-position:
        0 0, 
        0 0, 
        50px 0;       
      image-rendering: pixelated;
    }
    #restartBtn {
      display: none;
      padding: 10px 20px;
      font-size: 18px;
      background: #28a;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #restartBtn:hover {
      background: #3cf;
    }
  </style>
</head>
<body>
  <h1>Black Nigth Guns</h1>
  <p>A/D: Mover | W/S: Subir/Bajar | Espacio: Saltar | J: Atacar | K: Disparar | R: Recargar | H: Curar| P: Pausa</p>
  <canvas id="game" width="800" height="420"></canvas>
  <button id="restartBtn">Reintentar</button>

  <script>
class Entity {
  constructor(x, y, w, h, color, health = 100) {
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;
    this.color = color;
    this.health = health;
    this.maxHealth = health;
    this.knockbackVX = 0;
    this.knockbackFrames = 0;
  }

  update() {
    if (this.knockbackFrames > 0) {
      this.x += this.knockbackVX;
      this.knockbackVX *= 0.8;
      this.knockbackFrames--;
    }
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.w, this.h);

    // barra de vida si aplica
    if (this.maxHealth > 0) {
      ctx.fillStyle = "red";
      ctx.fillRect(this.x, this.y - 10, this.w, 5);
      ctx.fillStyle = "lime";
      ctx.fillRect(this.x, this.y - 10, this.w * (this.health / this.maxHealth), 5);
    }
  }
}

class Character extends Entity {
  constructor(x, y, w, h, color, health) {
    super(x, y, w, h, color, health);
    this.speed = 2;
    this.attackCooldown = 0;
  }

  attack(target) {} // polim贸rfico
  move() {} // polim贸rfico
}

class Player extends Character {
  constructor() {
    super(100, bottomLimit - 60, 40, 60, "#7F7F00", 100);
    this.vx = 0;
    this.vy = 0;
    this.direction = 1;
    this.isJumping = false;
    this.grounded = true;
    this.jumpHeight = 40;
    this.jumpDuration = 40;
    this.jumpProgress = 0;
    this.jumpOriginY = this.y;
    this.canShoot = true;
    this.reloading = false;
    this.healing = false;
    this.ammo = 25;
    this.bandages = 5;
    this.reloadTimer = 0;
    this.healTimer = 0;
  }

  move(keys) {
    this.vx = 0;
    this.vy = 0;
    if (keys["a"]) { this.vx = -this.speed; this.direction = -1; }
    if (keys["d"]) { this.vx = this.speed; this.direction = 1; }
    if (!this.isJumping) {
      if (keys["w"]) this.vy = -this.speed;
      if (keys["s"]) this.vy = this.speed;
    }
    if (keys[" "]) this.jump();
  }

  jump() {
    if (this.grounded) {
      this.jumpOriginY = this.y;
      this.jumpProgress = 0;
      this.isJumping = true;
      this.grounded = false;
    }
  }

  update() {
    super.update();
    this.x = Math.max(0, Math.min(canvas.width - this.w, this.x + this.vx));
    this.y = Math.max(topLimit, Math.min(bottomLimit - this.h, this.y + this.vy));

    // salto parab贸lico
    if (this.isJumping) {
      this.jumpProgress++;
      const t = this.jumpProgress / this.jumpDuration;
      const parabola = -4 * this.jumpHeight * t * (1 - t);
      this.y = this.jumpOriginY + parabola;
      if (this.jumpProgress >= this.jumpDuration) {
        this.y = this.jumpOriginY;
        this.isJumping = false;
        this.grounded = true;
      }
    }

    // recargar
    if (this.reloading) {
      this.reloadTimer--;
      if (this.reloadTimer <= 0) {
        this.canShoot = true;
        this.reloading = false;
      }
    }

    // curar
    if (this.healing) {
      this.healTimer--;
      if (this.healTimer <= 0) {
        this.healing = false;
        this.health = Math.min(this.maxHealth, this.health + 25);
      }
    }
  }

  attack(enemy) {
    if (this.attackCooldown === 0) {
      if (Math.abs(this.x - enemy.x) < 80 && Math.abs(this.y - enemy.y) < 50) {
        enemy.health -= 25;
        enemy.knockbackVX = this.direction === 1 ? 10 : -10;
        enemy.knockbackFrames = 10;
      }
      this.attackCooldown = 30;
    }
  }

  shoot(bullets) {
    if (this.canShoot && !this.reloading) {
      const offset = this.direction === 1 ? this.w : -5;
      bullets.push(new Bullet(this.x + offset, this.y + this.h / 2, this.direction));
      this.canShoot = false;
    }
  }
}

class Enemy extends Character {
  constructor(x, y) {
    super(x, y, 40, 60, "#400040", 100);
    this.speed = 1.2;
    this.damage = 10;
  }

  update(player) {
    super.update();
    let targetY = player.isJumping ? player.jumpOriginY : player.y;
    if (Math.abs(this.y - targetY) > 10) this.y += this.y < targetY ? this.speed : -this.speed;
    if (Math.abs(this.x - player.x) > 5) this.x += this.x < player.x ? this.speed : -this.speed;

    if (Math.abs(this.x - player.x) < 40 && Math.abs(this.y - player.y) < 40 && this.attackCooldown === 0) {
      player.health -= this.damage;
      player.knockbackVX = player.direction !== -1 ? -10 : 10;
      player.knockbackFrames = 10;
      this.attackCooldown = 60;
    }
  }
}

class Pickup extends Entity {
  constructor(x, y, color) {
    super(x, y, 10, 20, color, 0);
    this.active = true;
  }

  applyEffect(player) {} // polim贸rfico
}

class Ammo extends Pickup {
  constructor(x, y) { super(x, y, "yellow"); }
  applyEffect(player) { player.ammo += 2; this.active = false; }
}

class Heal extends Pickup {
  constructor(x, y) { super(x, y, "green"); }
  applyEffect(player) { player.bandages += 1; this.active = false; }
}

class Bullet extends Entity {
  constructor(x, y, direction) {
    super(x, y, 10, 10, "yellow", 0);
    this.radius = 5;
    this.speed = 8 * direction;
    this.active = true;
  }

  update(enemy) {
    this.x += this.speed;
    if (Math.abs(this.x - enemy.x) < 30 && Math.abs(this.y - enemy.y) < 40) {
      enemy.health -= 50;
      this.active = false;
      enemy.knockbackVX = player.direction === 1 ? 30 : -30;
      enemy.knockbackFrames = 12;
    }
    if (this.x < 0 || this.x > canvas.width) this.active = false;
  }

  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
  }
}
</script>

</body>
</html>
